# 服务测试指南

## 📋 测试页面访问

**URL**: http://localhost:5173/service-test

测试页面已集成到应用中，可以直接访问进行服务测试。

---

## 🧪 测试内容

### 1. Supabase 数据库服务测试

**测试项目：**
- ✅ 创建旅行计划
- ✅ 读取旅行计划列表
- ✅ 创建费用记录
- ✅ 读取费用记录
- ✅ 删除测试数据

**预期结果：**
- 所有 CRUD 操作成功
- 显示现有计划数量
- 显示测试计划 ID
- 自动清理测试数据

**可能的错误：**
- ❌ "Supabase API 未配置" → 请在设置页面配置 Supabase URL 和 Key
- ❌ "未授权" → 请先登录
- ❌ "数据库表不存在" → 请执行 `docs/database_setup.sql` 初始化数据库

---

### 2. AI 大语言模型服务测试（阿里云通义千问）

**测试项目：**
- ✅ AI 对话测试（询问北京旅游景点）
- ✅ 预算分析测试（北京 3 天 5000 元预算）

**预期结果：**
- AI 返回关于北京景点的介绍
- 预算分析返回各类别分配建议
- 显示预算类别数、警告数、建议数

**可能的错误：**
- ❌ "LLM API 未配置" → 请在设置页面配置阿里云 API Key 和 Endpoint
- ❌ "API Key 无效" → 请检查 API Key 是否正确
- ❌ "AI 响应格式错误" → AI 返回的不是有效 JSON，可能需要重试
- ❌ "AI 服务调用失败" → 检查网络连接或 API 配额

**注意事项：**
- AI 生成的内容可能需要 5-10 秒
- 如果返回格式错误，可以多次重试
- 确保 API Key 有足够的调用额度

---

### 3. 高德地图服务测试

**测试项目：**
- ✅ 地理编码（"天安门" → 坐标）
- ✅ POI 搜索（搜索"故宫"）
- ✅ 路径规划（天安门 → 故宫）

**预期结果：**
- 地理编码返回详细地址
- POI 搜索返回多个结果
- 路径规划返回距离和预计时间

**可能的错误：**
- ❌ "高德地图 API Key 未配置" → 请在设置页面配置高德地图 Key
- ❌ "搜索失败" → 检查 API Key 是否正确
- ❌ "地址解析失败" → 检查网络连接

**注意事项：**
- 高德地图 API 有每日调用限制
- 确保 API Key 已开通相应服务

---

### 4. 科大讯飞语音识别服务测试

**测试项目：**
- ✅ 实时语音识别（WebSocket）
- ✅ 音频采集和处理
- ✅ 识别结果实时返回

**预期结果：**
- 点击"开始录音"后，浏览器请求麦克风权限
- 说话时实时显示识别结果
- 点击"停止录音"后停止识别

**可能的错误：**
- ❌ "科大讯飞 API 未配置" → 请在设置页面配置 App ID、API Key、API Secret
- ❌ "麦克风权限被拒绝" → 请在浏览器设置中允许麦克风权限
- ❌ "WebSocket 连接失败" → 检查 API 配置是否正确
- ❌ "识别错误" → 检查 API Key 是否有效

**注意事项：**
- 需要 HTTPS 或 localhost 才能使用麦克风
- 确保环境安静，说话清晰
- 支持中英文混合识别

---

## 🔧 测试前准备

### 1. 配置环境变量

确保 `frontend/.env.local` 文件包含以下配置：

```env
# Supabase
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_key

# 高德地图
VITE_AMAP_KEY=your_amap_key

# 科大讯飞
VITE_XFEI_APP_ID=your_app_id
VITE_XFEI_API_KEY=your_api_key
VITE_XFEI_API_SECRET=your_api_secret

# 阿里云通义千问
VITE_ALIYUN_LLM_API_KEY=your_llm_key
VITE_ALIYUN_LLM_ENDPOINT=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
```

### 2. 初始化数据库

在 Supabase Dashboard 中执行 `docs/database_setup.sql`：

1. 登录 Supabase Dashboard
2. 进入 SQL Editor
3. 复制 `docs/database_setup.sql` 内容
4. 执行脚本
5. 确认表已创建（travel_plans, expenses, user_preferences）

### 3. 用户认证

- 如果测试 Supabase 服务，需要先登录
- 其他服务可以直接测试

---

## 📊 测试流程

### 方式一：一键测试（推荐）

1. 访问 http://localhost:5173/service-test
2. 点击 **"🚀 一键测试所有服务（除语音识别）"** 按钮
3. 等待所有测试完成（约 10-20 秒）
4. 查看每个服务的测试结果

### 方式二：单独测试

1. 访问测试页面
2. 点击每个服务卡片右上角的 **"测试"** 按钮
3. 查看测试结果
4. 如果失败，查看错误信息并修复

### 方式三：语音识别测试

1. 访问测试页面
2. 滚动到 "科大讯飞语音识别服务" 卡片
3. 点击 **"开始录音"** 按钮
4. 允许浏览器麦克风权限
5. 对着麦克风说话（例如："我想去北京旅游"）
6. 查看实时识别结果
7. 点击 **"停止录音"** 结束测试

---

## ✅ 测试成功标准

### Supabase 服务
- ✅ 绿色对勾图标
- ✅ 显示 "测试通过" 标签
- ✅ 显示现有计划数、测试计划 ID、费用数
- ✅ 消息提示 "Supabase 服务测试通过！"

### AI 大语言模型服务
- ✅ 绿色对勾图标
- ✅ 显示 "测试通过" 标签
- ✅ 显示 AI 对话响应内容
- ✅ 显示预算分析结果（类别数、警告数、建议数）
- ✅ 消息提示 "AI 大语言模型服务测试通过！"

### 高德地图服务
- ✅ 绿色对勾图标
- ✅ 显示 "测试通过" 标签
- ✅ 显示地理编码结果（详细地址）
- ✅ 显示 POI 搜索结果数
- ✅ 显示路径距离和预计时间
- ✅ 消息提示 "高德地图服务测试通过！"

### 语音识别服务
- ✅ 绿色对勾图标
- ✅ 显示 "识别成功" 标签
- ✅ 文本框中显示识别的文字
- ✅ 识别结果准确

---

## ❌ 常见问题排查

### 问题 1: 所有服务都提示 "未配置"

**原因**: 环境变量未加载

**解决方案**:
1. 检查 `frontend/.env.local` 文件是否存在
2. 确认文件名正确（不是 `.env.local.txt`）
3. 重启开发服务器：`npm run dev`

### 问题 2: Supabase 测试失败 "数据库表不存在"

**原因**: 数据库未初始化

**解决方案**:
1. 登录 Supabase Dashboard
2. 执行 `docs/database_setup.sql` 脚本
3. 刷新测试页面重试

### 问题 3: AI 服务返回 "API Key 无效"

**原因**: API Key 配置错误

**解决方案**:
1. 检查 `.env.local` 中的 `VITE_ALIYUN_LLM_API_KEY`
2. 确认 API Key 是否正确
3. 检查 API Endpoint 是否正确
4. 确认 API Key 有调用权限

### 问题 4: 高德地图测试失败

**原因**: API Key 未开通服务

**解决方案**:
1. 登录高德开放平台
2. 确认 API Key 已开通以下服务：
   - 地理编码
   - POI 搜索
   - 路径规划
3. 检查 API Key 是否有调用额度

### 问题 5: 语音识别无法启动

**原因**: 麦克风权限或 API 配置问题

**解决方案**:
1. 检查浏览器麦克风权限
2. 确认使用 HTTPS 或 localhost
3. 检查科大讯飞 API 配置（App ID、API Key、API Secret）
4. 查看浏览器控制台错误信息

---

## 🔍 调试技巧

### 1. 查看浏览器控制台

按 F12 打开开发者工具，查看：
- Console 标签：查看详细错误信息
- Network 标签：查看 API 请求和响应

### 2. 查看详细日志

测试页面会在控制台输出详细日志：
- ✅ 成功日志：绿色对勾 + 详细信息
- ❌ 失败日志：红色叉号 + 错误信息

### 3. 单步测试

如果一键测试失败，可以：
1. 单独测试每个服务
2. 查看具体哪个服务失败
3. 针对性修复问题

---

## 📝 测试报告

测试完成后，请记录以下信息：

| 服务 | 状态 | 备注 |
|------|------|------|
| Supabase | ✅/❌ | |
| AI 大语言模型 | ✅/❌ | |
| 高德地图 | ✅/❌ | |
| 语音识别 | ✅/❌ | |

---

## 🎯 下一步

如果所有服务测试通过：
1. ✅ 可以开始创建 UI 组件
2. ✅ 可以开始实现完整的行程创建流程
3. ✅ 可以开始实现预算管理功能

如果有服务测试失败：
1. ❌ 根据错误信息修复配置
2. ❌ 重新测试直到通过
3. ❌ 如有问题，查看详细错误日志

---

**测试页面路径**: `frontend/src/pages/ServiceTest.tsx`  
**路由配置**: `frontend/src/App.tsx`  
**访问地址**: http://localhost:5173/service-test

