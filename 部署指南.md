# 🚀 AI Web Planner - Windows 部署指南

## 📋 部署方式选择

根据你的情况,有两种部署方式:

### 方式1: 本地运行(推荐 - 简单快速)

✅ **优点:**
- 无需配置Docker
- 启动快速
- 支持热重载,开发调试方便
- 不受网络限制

❌ **缺点:**
- 需要手动管理两个服务
- 不适合生产环境部署

**适用场景:** 开发、测试、演示

### 方式2: Docker部署(生产环境推荐)

✅ **优点:**
- 环境隔离,更稳定
- 一键启动所有服务
- 适合生产环境
- 易于迁移和扩展

❌ **缺点:**
- 需要配置Docker镜像加速器
- 首次构建较慢
- 需要解决网络问题

**适用场景:** 生产部署、服务器运行

---

## 🎯 快速开始

### 方式1: 本地运行(推荐新手)

#### 步骤1: 运行启动脚本

双击运行或在命令行执行:

```bash
start-local.bat
```

#### 步骤2: 等待服务启动

脚本会自动:
- ✅ 检查Node.js环境
- ✅ 安装依赖(如果需要)
- ✅ 启动后端服务(3001端口)
- ✅ 启动前端服务(5173端口)
- ✅ 打开浏览器

#### 步骤3: 访问应用

浏览器会自动打开: http://localhost:5173

#### 步骤4: 配置API Keys

1. 点击右上角设置图标 ⚙️
2. 填入以下API Keys:
   - Supabase URL 和 Anon Key
   - 科大讯飞 App ID、API Key、API Secret
   - 高德地图 Web Key
   - 阿里云通义千问 API Key 和 Endpoint
3. 点击保存

#### 停止服务

方法1: 关闭两个命令窗口
方法2: 运行停止脚本:

```bash
stop-local.bat
```

---

### 方式2: Docker部署

#### 前置要求

1. **安装Docker Desktop**
   - 下载: https://www.docker.com/products/docker-desktop
   - 安装并重启电脑
   - 启动Docker Desktop

2. **配置镜像加速器(重要!)**

   由于网络问题,必须先配置镜像加速器:

   1. 打开 Docker Desktop
   2. 点击右上角设置图标 → Settings
   3. 选择 Docker Engine
   4. 添加以下配置:

   ```json
   {
     "registry-mirrors": [
       "https://docker.m.daocloud.io",
       "https://docker.1panel.live",
       "https://hub.rat.dev"
     ]
   }
   ```

   5. 点击 Apply & Restart
   6. 等待Docker重启完成

#### 步骤1: 运行部署脚本

```bash
docker-deploy.bat
```

#### 步骤2: 等待构建完成

首次构建需要5-10分钟,请耐心等待。

#### 步骤3: 访问应用

- 前端: http://localhost:3000
- 后端: http://localhost:3001

#### 常用Docker命令

```bash
# 查看容器状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose stop

# 启动服务
docker-compose start

# 重启服务
docker-compose restart

# 删除容器
docker-compose down
```

---

## 🔧 故障排查

### 问题1: Docker构建失败 - 网络错误

**错误信息:**
```
failed to fetch oauth token: dial tcp 162.125.2.5:443: connectex
```

**解决方案:**

1. **配置镜像加速器**(见上方Docker部署 → 前置要求 → 步骤2)

2. **使用VPN或代理**
   - Docker Desktop → Settings → Resources → Proxies
   - 启用代理并填入代理地址

3. **改用本地运行方式**
   ```bash
   start-local.bat
   ```

详细解决方案: 查看 `DOCKER_NETWORK_FIX.md`

---

### 问题2: 端口被占用

**错误信息:**
```
Port 3000 is already in use
Port 3001 is already in use
Port 5173 is already in use
```

**解决方案:**

#### 方法1: 查找并关闭占用端口的程序

```bash
# 查找占用端口的进程
netstat -ano | findstr :3000
netstat -ano | findstr :3001
netstat -ano | findstr :5173

# 根据PID关闭进程
taskkill /F /PID <进程ID>
```

#### 方法2: 修改端口

编辑 `docker-compose.yml` 或前端配置文件,更改端口号。

---

### 问题3: npm install 失败

**解决方案:**

1. **清理缓存**
   ```bash
   npm cache clean --force
   ```

2. **使用国内镜像**
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```

3. **重新安装**
   ```bash
   cd frontend
   rmdir /s /q node_modules
   npm install

   cd ../backend
   rmdir /s /q node_modules
   npm install
   ```

---

### 问题4: 前端显示空白页面

**解决方案:**

1. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签页的错误信息

2. **检查API Keys配置**
   - 确保在设置页面填入了正确的API Keys

3. **检查后端服务**
   ```bash
   curl http://localhost:3001/health
   ```
   应该返回: `{"status":"ok"}`

4. **清理浏览器缓存**
   - Ctrl + Shift + Delete
   - 清除缓存和Cookie

---

## 📊 对比表格

| 特性 | 本地运行 | Docker部署 |
|------|----------|------------|
| 启动速度 | ⚡ 快 | 🐢 较慢(首次) |
| 环境要求 | Node.js | Docker Desktop |
| 网络要求 | 低 | 高(需下载镜像) |
| 适用场景 | 开发/测试 | 生产环境 |
| 热重载 | ✅ 支持 | ❌ 不支持 |
| 环境隔离 | ❌ 无 | ✅ 完全隔离 |
| 资源占用 | 低 | 中等 |
| 配置难度 | ⭐ 简单 | ⭐⭐⭐ 中等 |

---

## 🎯 推荐方案

### 如果你是:

**学生/初学者/快速演示**
→ 使用 `start-local.bat` (本地运行)

**开发者/需要调试**
→ 使用 `start-local.bat` (本地运行)

**生产部署/服务器运行**
→ 使用 `docker-deploy.bat` (Docker部署)

**网络环境不好**
→ 使用 `start-local.bat` (本地运行)

---

## 📚 相关文档

- [Docker快速部署指南](DOCKER_QUICK_START.md)
- [Docker网络问题解决](DOCKER_NETWORK_FIX.md)
- [完整项目文档](README.md)
- [API配置说明](docs/SETUP.md)

---

## 🆘 需要帮助?

### 本地运行问题

1. 确保安装了 Node.js (v16+)
2. 检查端口是否被占用
3. 查看命令窗口的错误信息

### Docker部署问题

1. 确保Docker Desktop正在运行
2. 配置镜像加速器
3. 查看 `DOCKER_NETWORK_FIX.md`

---

## ✅ 验证部署

### 本地运行验证

1. 访问 http://localhost:5173
2. 应该看到登录页面
3. 后端健康检查: http://localhost:3001/health

### Docker部署验证

1. 访问 http://localhost:3000
2. 应该看到登录页面
3. 后端健康检查: http://localhost:3001/health

---

**祝你部署顺利!** 🎉

如有问题,请查看相关文档或提供错误信息。

