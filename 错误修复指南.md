# ❌ 错误修复指南

## 🐛 你遇到的错误

运行 `.\docker-deploy.ps1` 时出现网络连接错误:

```
failed to fetch oauth token: Post "https://auth.docker.io/token": 
dial tcp 157.240.7.8:443: connectex: A connection attempt failed
```

**问题原因**: Docker 无法连接到 Docker Hub 下载镜像

---

## ✅ 快速解决方案 (3 步)

### 第 1 步: 打开 Docker Desktop 设置

1. 右键点击系统托盘的 **Docker 图标** (鲸鱼图标)
2. 选择 **"Settings"** (设置)
3. 在左侧菜单选择 **"Docker Engine"**

### 第 2 步: 添加镜像加速器

在配置编辑器中,添加以下内容:

```json
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://docker.1panel.live",
    "https://hub.rat.dev"
  ]
}
```

**注意事项**:
- 如果配置文件中已有其他内容,只需添加 `"registry-mirrors"` 这一行
- 确保 JSON 格式正确 (注意逗号和括号)
- 不要删除原有的配置

**完整配置示例**:
```json
{
  "builder": {
    "gc": {
      "defaultKeepStorage": "20GB",
      "enabled": true
    }
  },
  "experimental": false,
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://docker.1panel.live",
    "https://hub.rat.dev"
  ]
}
```

### 第 3 步: 应用并重启

1. 点击右下角的 **"Apply & Restart"** 按钮
2. 等待 Docker Desktop 重启 (约 30-60 秒)
3. 确认 Docker 图标变为绿色

---

## 🔍 验证配置是否成功

打开 PowerShell,运行:

```powershell
docker info | Select-String "Registry Mirrors"
```

如果看到类似以下输出,说明配置成功:

```
Registry Mirrors:
  https://docker.m.daocloud.io/
  https://docker.1panel.live/
  https://hub.rat.dev/
```

---

## 🚀 重新运行部署

配置完成后,重新运行部署脚本:

```powershell
.\docker-deploy.ps1
```

这次应该可以正常下载镜像并构建了!

---

## 📋 可选: 使用辅助脚本

我已经创建了一个辅助脚本来帮助你配置:

```powershell
.\fix-docker-network.ps1
```

这个脚本会:
- ✅ 显示推荐的镜像源
- ✅ 提供配置示例
- ✅ 尝试打开 Docker 设置页面
- ✅ 验证配置是否成功

---

## 🌟 推荐的镜像源

### 国内公共镜像源 (推荐)

| 镜像源 | 地址 | 特点 |
|--------|------|------|
| **DaoCloud** | https://docker.m.daocloud.io | 稳定可靠,速度快 |
| **1Panel** | https://docker.1panel.live | 新兴镜像源,速度好 |
| **Rat Dev** | https://hub.rat.dev | 备用选择 |

### 云服务商镜像源

| 服务商 | 地址 | 说明 |
|--------|------|------|
| **阿里云** | https://xxxxxx.mirror.aliyuncs.com | 需要登录获取专属地址 |
| **腾讯云** | https://mirror.ccs.tencentyun.com | 公开可用 |
| **网易云** | https://hub-mirror.c.163.com | 公开可用 |

---

## 💡 阿里云镜像加速器 (最推荐)

如果你有阿里云账号,强烈推荐使用阿里云的专属镜像加速器:

### 获取步骤:

1. 访问: https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors
2. 登录阿里云账号
3. 复制你的专属加速器地址

### 配置示例:

```json
{
  "registry-mirrors": [
    "https://xxxxxx.mirror.aliyuncs.com"
  ]
}
```

替换 `xxxxxx` 为你的实际加速器地址。

---

## ❓ 常见问题

### Q1: 配置后还是报同样的错误?

**A**: 
1. 确认 Docker Desktop 已经重启完成
2. 检查 JSON 格式是否正确
3. 尝试更换其他镜像源
4. 运行 `docker info` 确认配置已生效

### Q2: 找不到 Docker Engine 设置?

**A**: 
1. 确保 Docker Desktop 已经启动
2. 在设置中查找 "Docker Engine" 或 "Daemon"
3. 如果是旧版本,可能叫 "Daemon" 标签

### Q3: 点击 Apply & Restart 后 Docker 无法启动?

**A**: 
1. 检查 JSON 格式是否正确 (使用 JSON 验证工具)
2. 恢复备份配置
3. 重新安装 Docker Desktop

### Q4: 所有镜像源都无法使用?

**A**: 
1. 检查防火墙设置
2. 检查网络代理配置
3. 联系网络管理员 (如果在企业网络)
4. 尝试使用 VPN

---

## 🔧 其他解决方案

### 方案 1: 配置网络代理

如果你使用代理上网:

1. 打开 Docker Desktop 设置
2. 选择 "Resources" → "Proxies"
3. 配置代理服务器地址

### 方案 2: 修改 DNS

在 Docker Engine 配置中添加:

```json
{
  "dns": [
    "8.8.8.8",
    "114.114.114.114"
  ]
}
```

### 方案 3: 清理 Docker 缓存

```powershell
# 清理构建缓存
docker builder prune -a

# 清理所有未使用的资源
docker system prune -a
```

---

## 📚 相关文档

- 📖 [网络问题解决方案.md](网络问题解决方案.md) - 详细的解决方案
- 🔧 [fix-docker-network.ps1](fix-docker-network.ps1) - 辅助配置脚本
- 🚀 [docker-deploy.ps1](docker-deploy.ps1) - 部署脚本

---

## 🎯 完整流程总结

1. ✅ 打开 Docker Desktop 设置
2. ✅ 进入 Docker Engine 配置
3. ✅ 添加 registry-mirrors 配置
4. ✅ 点击 Apply & Restart
5. ✅ 等待 Docker 重启完成
6. ✅ 验证配置: `docker info`
7. ✅ 运行部署: `.\docker-deploy.ps1`

---

**问题**: Docker 无法连接到 Docker Hub  
**原因**: 网络连接问题  
**解决**: 配置镜像加速器  
**时间**: 约 5 分钟  
**难度**: ⭐⭐☆☆☆ (简单)

**配置完成后,部署应该可以正常进行!** 🎉

